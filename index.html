<!DOCTYPE html>
<html>
<head>
    <title>netsh helper</title>

    <style>
        table {
            margin-top: 50px;
            border-collapse: collapse;
            width: 100%;
            text-align: center;
        }

        table tr:nth-child(even) {
            background: lightgray;
        }

        .actions {
            margin-bottom: 20px;
        }

        label {
            display: block;
        }
    </style>
</head>
<body>

<div class="actions">
    <input type="button" value="ntsh list refresh" id="netshListButton"/>
</div>

<div class="add">
    <label>ListenAddress</label>
    <input type="text" id="input-listen-address"/>
    <label>ListenPort</label>
    <input type="number" id="input-listen-port"/>

    <label>ConnectAddress</label>
    <input type="text" id="input-connect-address"/>

    <label>ConnectPort</label>
    <input type="number" id="input-connect-port"/>

    <input type="button" value="add" id="add-button"/>
</div>

<label>Delete</label>
<input type="number" id="delete-id"/>
<input type="button" id="delete-button" value="Delete" />

<table id="table">

</table>

<script src="/socket.io/socket.io.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        var netshList = [];

        const socket = io('http://localhost');

        /** received events */
        socket.on('netsh list', (data) => {
            netshList = [];
            const lastIndex = data.lastIndexOf('-');
            data = data.substr(lastIndex + 1).replace(/\r?\n|\r/g, ' ').replace(/  +/g, ' ').trim().split(' ');

            for (var i = 0; i < data.length; i++) {
                var id = i;
                var listenAddress = data[i];
                var listenPort = data[++i];
                var connectAddress = data[++i];
                var connectPort = data[++i];

                netshList.push({
                    id,
                    listenAddress,
                    listenPort,
                    connectAddress,
                    connectPort
                })
            }

            generateTable();
        });


        /** buttons */
        const netshListButton = document.getElementById('netshListButton');
        const netshAddButton = document.getElementById('add-button');
        const netshDeleteButton = document.getElementById('delete-button');

        /** sending events **/
        netshListButton.addEventListener('click', (e) => {
            socket.emit('netsh get list');
        });

        netshAddButton.addEventListener('click', function() {
            var listenAddress = document.getElementById('input-listen-address').value;
            var listenPort = document.getElementById('input-listen-port').value;
            var connectAddress = document.getElementById('input-connect-address').value;
            var connectPort = document.getElementById('input-connect-port').value;

            socket.emit('netsh add', {
                listenAddress,
                listenPort,
                connectAddress,
                connectPort
            })
        });

        netshDeleteButton.addEventListener('click', function() {
            const id = document.getElementById('delete-id').value;

            const el = netshList.find(e => e.id === +id);
            socket.emit('netsh delete', el);
        });

        function generateTable() {
            const table = document.getElementById('table');
            table.innerHTML = "";

            const headerTr = document.createElement('tr');

            const headerId = document.createElement('th');
            headerId.innerText = 'ID';

            const headerTh1 = document.createElement('th');
            headerTh1.innerText = "ListenAddress";
            const headerTh2 = document.createElement('th');
            headerTh2.innerText = "ListenPort";
            const headerTh3 = document.createElement('th');
            headerTh3.innerText = "ConnectAddress";
            const headerTh4 = document.createElement('th');
            headerTh4.innerText = "ConnectPort";

            headerTr.appendChild(headerId);
            headerTr.appendChild(headerTh1);
            headerTr.appendChild(headerTh2);
            headerTr.appendChild(headerTh3);
            headerTr.appendChild(headerTh4);

            table.appendChild(headerTr);

            for(item of netshList) {
                const tr = document.createElement('tr');

                const headerId = document.createElement('td');
                headerId.innerText = item.id;

                const header1 = document.createElement('td');
                header1.innerText = item.listenAddress;

                const header2 = document.createElement('td');
                header2.innerText = item.listenPort;

                const header3 = document.createElement('td');
                header3.innerText = item.connectAddress;

                const header4 = document.createElement('td');
                header4.innerText = item.connectPort;

                tr.appendChild(headerId);
                tr.appendChild(header1);
                tr.appendChild(header2);
                tr.appendChild(header3);
                tr.appendChild(header4);

                table.appendChild(tr);
            }
        }


    });


</script>
</body>
</html>